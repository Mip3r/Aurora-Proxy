<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SunMoon Proxy</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      height: 100vh;
      overflow: hidden;
      font-family: 'Poppins', sans-serif;
      color: white;
      background: radial-gradient(ellipse at bottom, #0a0b12 0%, #000000 100%);
    }

    /* Aurora animated glow background */
    .aurora {
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(125deg,
        #00ffc8, #3f8cff, #a14eff, #ff4e9b, #00ffc8);
      background-size: 400% 400%;
      animation: auroraMove 15s ease infinite;
      filter: blur(200px);
      z-index: -1;
      opacity: 0.6;
    }

    @keyframes auroraMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Main glass container */
    .container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 25px;
      backdrop-filter: blur(20px);
      padding: 80px 160px;
      text-align: center;
      box-shadow: 0 0 50px rgba(0,255,255,0.2);
      transition: 0.3s ease;
    }

    .container:hover {
      box-shadow: 0 0 80px rgba(0,255,255,0.3);
      transform: translate(-50%, -50%) scale(1.02);
    }

    .title {
      font-size: 64px;
      letter-spacing: 6px;
      font-weight: 700;
      background: linear-gradient(to right, #00fff0, #7b5eff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 40px;
      text-transform: uppercase;
    }

    /* Side buttons */
    .side {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .side.left { left: 40px; }
    .side.right { right: 40px; }

    .side img {
      width: 60px;
      height: 60px;
      cursor: pointer;
      opacity: 0.8;
      transition: 0.2s ease;
    }

    .side img:hover {
      opacity: 1;
      transform: scale(1.1);
      filter: drop-shadow(0 0 15px rgba(0,255,255,0.5));
    }
  </style>
</head>
<body>
  <div class="aurora"></div>

  <div class="app">
    <header class="header">
      <a class="brand" href="index.html">
        <img src="assets/logo.png" alt="SunMoon logo">
        <div class="name">SunMoon Proxy</div>
      </a>

      <nav class="nav">
        <a href="games.html">Games</a>
        <a href="info.html">Info</a>
        <a href="browser.html">Browser</a>
        <a href="settings.html">Settings</a>
      </nav>
      <!-- URL / Search bar -->
      <form id="navForm" onsubmit="onNavigate(event)" style="margin-left:16px; display:flex; gap:8px; align-items:center;">
        <input id="urlBar" type="search" placeholder="Go to URL or search..." style="padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:inherit; min-width:220px">
        <button type="submit" class="cta" style="padding:8px 12px; font-size:14px">Go</button>
      </form>
    </header>

    <div class="main">
      <section class="hero">
        <div class="title">SunMoon Proxy</div>
        <div class="subtitle">A lightweight web-proxy interface with embedded HTML games.</div>
        <a class="cta" href="games.html">Play games</a>
      </section>
    </div>

    <!-- Side buttons for quick actions -->
    <div class="side left">
      <img src="assets/settings_button.png" alt="Settings" onclick="location.href='settings.html'">
    </div>

    <div class="side right">
      <img src="assets/browser_button.png" alt="Browser" onclick="location.href='browser.html'">
      <img src="assets/games_button.png" alt="Games" onclick="location.href='games.html'">
    </div>

  </div>

  <!-- Version popup -->
  <div id="versionPopup" class="version-popup">
    New version available â€” <a id="versionLink" href="#" target="_blank">relaunch</a>
  </div>

  <!-- Embed modal (reused on games page) -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="controls">
        <div class="meta">Game</div>
        <button class="close" onclick="closeModal()">Close</button>
      </div>
      <iframe id="gameFrame" src="about:blank" allowfullscreen></iframe>
    </div>
  </div>

  <script>
    // Version check: compare local version.txt with remote hosted version
    async function fetchLocalVersion(){
      try{
        const r = await fetch('version.txt', {cache: 'no-store'});
        const txt = await r.text();
        const js = JSON.parse(txt);
        return js.version;
      }catch(e){ console.warn('local version read failed', e); return null }
    }

    async function fetchRemoteVersion(){
      // TODO: replace this URL with your hosted version.json on GitHub Pages or raw.githubusercontent.com
      const remote = 'https://raw.githubusercontent.com/Mip3r/SunMoonProxy/main/version.txt';
      try{
        const r = await fetch(remote, {cache: 'no-store'});
        const txt = await r.text();
        const js = JSON.parse(txt);
        return js.version;
      }catch(e){ console.warn('remote version fetch failed', e); return null }
    }

    function showVersionPopup(link){
      const el = document.getElementById('versionPopup');
      const a = document.getElementById('versionLink');
      a.href = link;
      el.classList.add('show');
    }

    async function checkVersion(){
      const local = await fetchLocalVersion();
      const remote = await fetchRemoteVersion();
      if(!local || !remote) return;
      if(local !== remote){
        // open relaunch link to GitHub repo
        showVersionPopup('https://github.com/Mip3r/SunMoonProxy');
      }
    }

    // Modal helpers (used by games page too)
    function openModal(url){
      const backdrop = document.getElementById('modalBackdrop');
      const frame = document.getElementById('gameFrame');
      frame.src = url;
      backdrop.classList.add('show');
    }
    function closeModal(){
      const backdrop = document.getElementById('modalBackdrop');
      const frame = document.getElementById('gameFrame');
      frame.src = 'about:blank';
      backdrop.classList.remove('show');
    }

    // Kick off version check after page load
    window.addEventListener('load', () => { checkVersion(); });

    // Client navigation / search helper
    // Set PROXY_BASE to your deployed proxy Worker URL, e.g. 'https://your-worker.mydomain.workers.dev/?url='
    const PROXY_BASE = '';
    function isLikelyURL(input){
      return /^https?:\/\//i.test(input) || /\./.test(input);
    }
    function onNavigate(e){
      e.preventDefault();
      const val = document.getElementById('urlBar').value.trim();
      if(!val) return;
      if(isLikelyURL(val)){
        const target = /^https?:\/\//i.test(val) ? val : 'https://' + val;
        if(PROXY_BASE){
          window.open(PROXY_BASE + encodeURIComponent(target), '_blank');
        }else{
          // No proxy configured; open directly in new tab
          window.open(target, '_blank');
        }
      }else{
        // Treat as search query
        const q = encodeURIComponent(val);
        window.open('https://www.google.com/search?q=' + q, '_blank');
      }
    }
  </script>
</body>
</html>
